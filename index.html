<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Code Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/theme/material-ocean.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --tab-bg: #2d2d2d;
            --accent: #569cd6;
            --text: #d4d4d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-color);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: calc(100vh - 40px);
            gap: 5px;
            padding: 5px;
        }

        .editor-pane, .preview-pane {
            background: var(--tab-bg);
            border-radius: 6px;
            overflow: hidden;
        }

        .tabs-bar {
            display: flex;
            background: #252526;
            padding: 5px 10px 0 10px;
            gap: 5px;
            border-bottom: 1px solid #333;
        }

        .tab {
            padding: 8px 20px;
            cursor: pointer;
            background: #2d2d2d;
            border-radius: 6px 6px 0 0;
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .tab.active {
            background: var(--bg-color);
            color: var(--accent);
        }

        .tab i {
            font-size: 0.8em;
            opacity: 0.7;
        }

        .toolbar {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background: #252526;
            border-bottom: 1px solid #333;
            gap: 10px;
        }

        button {
            padding: 6px 12px;
            background: #3a3d41;
            border: none;
            border-radius: 4px;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--accent);
            color: white;
        }

        .CodeMirror {
            height: calc(100vh - 120px) !important;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            padding: 10px 0;
        }

        #preview {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .file-tab {
            position: relative;
        }

        .file-tab input {
            background: transparent;
            border: none;
            color: inherit;
            width: 120px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button onclick="runCode()">
            <i class="fas fa-play"></i> Run
        </button>
        <button onclick="downloadCode()">
            <i class="fas fa-download"></i> Export
        </button>
        <button onclick="openNewTab()">
            <i class="fas fa-external-link-alt"></i> New Tab
        </button>
        <div style="flex-grow: 1"></div>
        <button onclick="toggleLayout('vertical')">
            <i class="fas fa-columns"></i>
        </button>
        <button onclick="toggleLayout('horizontal')">
            <i class="fas fa-rows"></i>
        </button>
    </div>

    <div class="container" id="container">
        <div class="editor-pane">
            <div class="tabs-bar">
                <div class="tab active" data-file="index.html">
                    <i class="fab fa-html5"></i>
                    <div class="file-tab">
                        <input value="index.html" readonly>
                    </div>
                </div>
                <div class="tab" data-file="style.css">
                    <i class="fab fa-css3-alt"></i>
                    <div class="file-tab">
                        <input value="style.css" readonly>
                    </div>
                </div>
                <div class="tab" data-file="script.js">
                    <i class="fab fa-js-square"></i>
                    <div class="file-tab">
                        <input value="script.js" readonly>
                    </div>
                </div>
            </div>
            <div id="html-editor" class="editor active"></div>
            <div id="css-editor" class="editor"></div>
            <div id="js-editor" class="editor"></div>
        </div>
        <div class="preview-pane">
            <iframe id="preview"></iframe>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/javascript/javascript.min.js"></script>

    <script>
        const editors = {
            'index.html': CodeMirror(document.getElementById('html-editor'), {
                mode: 'htmlmixed',
                theme: 'material-ocean',
                lineNumbers: true,
                autoCloseTags: true,
                indentUnit: 4,
                value: `<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Hello World</h1>
    <script src="script.js"></script>
</body>
</html>`
            }),
            'style.css': CodeMirror(document.getElementById('css-editor'), {
                mode: 'css',
                theme: 'material-ocean',
                lineNumbers: true,
                value: `body {
    background: #f0f0f0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}`
            }),
            'script.js': CodeMirror(document.getElementById('js-editor'), {
                mode: 'javascript',
                theme: 'material-ocean',
                lineNumbers: true,
                value: `console.log('Hello from JavaScript!');\n\ndocument.querySelector('h1').addEventListener('click', () => {\n    alert('Clicked!');\n});`
            })
        };

        // Tab management
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.editor').forEach(e => e.style.display = 'none');
                tab.classList.add('active');
                const file = tab.dataset.file;
                document.getElementById(`${file.split('.')[0]}-editor`).style.display = 'block';
                editors[file].refresh();
            });
        });

        function runCode() {
            const html = editors['index.html'].getValue();
            const css = editors['style.css'].getValue();
            const js = editors['script.js'].getValue();
            
            const fullCode = `
                ${html.replace('</head>', `<style>${css}</style></head>`)}
                <script>${js}<\/script>
            `;
            
            document.getElementById('preview').srcdoc = fullCode;
        }

        function downloadCode() {
            const html = editors['index.html'].getValue();
            const css = editors['style.css'].getValue();
            const js = editors['script.js'].getValue();
            
            const files = {
                'index.html': html,
                'style.css': css,
                'script.js': js
            };
            
            const zip = new JSZip();
            for (const [filename, content] of Object.entries(files)) {
                zip.file(filename, content);
            }
            
            zip.generateAsync({type: "blob"}).then(blob => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'project.zip';
                link.click();
            });
        }

        function openNewTab() {
            const html = editors['index.html'].getValue();
            const css = editors['style.css'].getValue();
            const js = editors['script.js'].getValue();
            
            const fullCode = `
                ${html.replace('</head>', `<style>${css}</style></head>`)}
                <script>${js}<\/script>
            `;
            
            const newWindow = window.open('about:blank');
            newWindow.document.write(fullCode);
            newWindow.document.close();
        }

        function toggleLayout(direction) {
            const container = document.getElementById('container');
            container.style.gridTemplateColumns = direction === 'vertical' ? '1fr 1fr' : '1fr';
            container.style.gridTemplateRows = direction === 'horizontal' ? '1fr 1fr' : '1fr';
        }

        // Initial setup
        runCode();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</body>
</html>
